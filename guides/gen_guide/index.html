
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>General description - Qlue</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="deep-purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#general-description" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Qlue" class="md-header__button md-logo" aria-label="Qlue" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Qlue
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              General description
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Qlue" class="md-nav__button md-logo" aria-label="Qlue" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Qlue
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome to Qlue
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          General description
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        General description
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-big-picture" class="md-nav__link">
    The big picture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-use-case" class="md-nav__link">
    A use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-client" class="md-nav__link">
    The client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-server" class="md-nav__link">
    The server
  </a>
  
    <nav class="md-nav" aria-label="The server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-django-app-qlue" class="md-nav__link">
    The Django app (qlue)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-dropbox-storage" class="md-nav__link">
    The Dropbox storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-backends" class="md-nav__link">
    The backends
  </a>
  
    <nav class="md-nav" aria-label="The backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-simulator-backend" class="md-nav__link">
    The simulator backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-experiment-backend" class="md-nav__link">
    The experiment backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_guide/" class="md-nav__link">
        User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-big-picture" class="md-nav__link">
    The big picture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-use-case" class="md-nav__link">
    A use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-client" class="md-nav__link">
    The client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-server" class="md-nav__link">
    The server
  </a>
  
    <nav class="md-nav" aria-label="The server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-django-app-qlue" class="md-nav__link">
    The Django app (qlue)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-dropbox-storage" class="md-nav__link">
    The Dropbox storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-backends" class="md-nav__link">
    The backends
  </a>
  
    <nav class="md-nav" aria-label="The backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-simulator-backend" class="md-nav__link">
    The simulator backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-experiment-backend" class="md-nav__link">
    The experiment backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="general-description">General description</h1>
<h2 id="the-big-picture">The big picture</h2>
<p>The idea for developing <a href="https://github.com/synqs/qlue" title="qlue">qlue</a> stems from the desire for unifying experiment execution on different platforms for quantum simulation/computation. These platforms can be based on different technologies (e.g. neutral atoms, ions, superconducting qubits, photonic systems etc.) and have different software for experiment control.</p>
<p>In this diversity there is a unifying feature for different experiments, they essentially act as a backend for executing some instructions. On adopting this picture we quickly realise that we become totally agnostic to the details of how the instructions are executed on a hardware if we can provide a general higher level description of the experiments. A very suitable high-level description for experiments on different platforms is to think of these experiments as quantum circuits. In this picture any experiment essentially has three steps : state preparation, unitary evolution under a given Hamiltonian and measurement. Infact we are not just limited to experiments anymore and can even include theoretical simulator backends which execute the quantum circuits on a computer.</p>
<p>For providing software support for a given backend to use the language of quantum circuits, two types of libraries are required : one which allows to write quantum circuits for the experiments using some kind of quantum circuit framework and a second one for parsing the quantum circuits into a format which can be run on the experiment. For the first one, there already exists quantum circuit frameworks like <a href="https://github.com/Qiskit" title="Qiskit">Qiskit</a>, <a href="https://github.com/PennyLaneAI" title="Pennylane">Pennylane</a> etc. which provide a comprehensive support for writing quantum circuits. For the second one, custom code has to be written which will depend on the details of the particular backend.</p>
<p>Another important point is that we assume that the user who writes the quantum circuits does not necessarily have local access to experiments. So the user submits quantum circuits to the backend remotely over the internet. We use the word job for the submissions by the remote user. Therefore, we also need a service which can act as the central point for various remote users to submit their jobs or fetch the result/status of their previously submitted jobs. For security reasons this service should provide robust user management and authentication.</p>
<p>To address the issue we have developed a web interface called <a href="https://github.com/synqs/qlue" title="qlue">qlue</a> which allows remote users to submit their jobs to remote cold atom backends. This architecture has several advantages :</p>
<ul>
<li>The same circuit can be executed on different backends.</li>
<li>Makes collaboration between researchers easier.</li>
<li>A nice tool for teaching.</li>
</ul>
<h2 id="a-use-case">A use case</h2>
<p>We want to use our quantum computing backends as platforms for executing experiments written as quantum circuits. These backends can be a real cold atom machine or a simulator running on a computer . But how will the backend understand a quantum circuit? For e.g. in our experiment we use the <a href="https://github.com/labscript-suite" title="labscript">labscript suite</a> to control all hardware and for data analysis. We need to tackle the following issues:</p>
<ul>
<li>Labscript suite does not have native support for writing quantum circuits.</li>
<li>We want to allow remote users to be able to submit jobs to our backends. So we need a server architecture and user management.</li>
</ul>
<p>The above issues can also exist for a simulator package. Hence the need for <a href="https://github.com/synqs/qlue" title="qlue">this project</a>. There are two sides : <a href="#the-client">client</a> and <a href="#the-server">server</a>.</p>
<h2 id="the-client">The client</h2>
<p>A client is a remote user who will write quantum circuits in the user's favorite quantum circuit framework (<a href="https://github.com/Qiskit" title="Qiskit">Qiskit</a>/<a href="https://github.com/PennyLaneAI" title="Pennylane">Pennylane</a>/something_else). These circuits then have to be compiled into JSON files. The JSON files can be sent over the internet to a remote server which will queue it for parsing/execution on the backend. The backend can be a real cold atom machine or a simulator running on a computer. To get credentials, user has to create an account at <a href="https://qsimsim.synqs.org/">qsimsim.synqs.org</a>.</p>
<p>We have decided on a schema for the JSON files. See <a href="https://github.com/eggerdj/backends/" title="Qiskit_json">1</a>  for more details. The document mentions in detail how things should be formatted.</p>
<p>The plugin for compiling Qiskit circuits to JSON files is available at <a href="https://github.com/Qiskit-Extensions/qiskit-cold-atom"><code>qiskit-cold-atom</code></a>. Similarly the plugin for compiling a pennylane circuit into JSON is available at <a href="https://github.com/synqs/pennylane-ls" title="penny_json"><code>pennylane-ls</code></a>. Note that the pennylane plugin at <a href="https://github.com/synqs/pennylane-ls" title="penny_json"><code>pennylane-ls</code></a> already offers several backends. Each backend is a device with its own operations.</p>
<p>That's all that is required on the client side. Basically choose one of these frameworks. If the client wants to use a different quantum circuit framework, then the client must write appropriate code for compiling quantum circuits of that framework into JSON files which follow the schema of <a href="https://github.com/eggerdj/backends/" title="Qiskit_json">1</a>.</p>
<h2 id="the-server">The server</h2>
<p>Here we describe 3 parts:</p>
<ul>
<li>The Django app (qlue).</li>
<li>The Dropbox storage.</li>
<li>The backends.</li>
</ul>
<p><img alt="" src="../arch.png" /></p>
<h3 id="the-django-app-qlue">The Django app (qlue)</h3>
<p>The <a href="https://www.heroku.com/home" title="Heroku">Heroku</a> platform hosts our <a href="https://github.com/django" title="Django">Django</a> app. Django is a Python-based free and open-source web framework. It uses the Model-View-Template architecture:</p>
<ul>
<li>Model : Build databases from classes with the help of Object Relational Mapper (ORM).</li>
<li>View : Function executed whenever a particular URL receives an HTTP request. For every URL there is a corresponding view function.</li>
<li>Template : HTML/CSS code for inserting web elements in a HTML document.</li>
</ul>
<p>Note that <a href="https://github.com/django" title="Django">Django</a> is just a framework to design web-apps. Its not a server by itself. After writing a webapp it has to be hosted on a server. Although, Django also comes with a built-in server but this is meant only for local testing and development. In production environment one must use a proper server like <a href="https://httpd.apache.org/" title="Apache">Apache web server</a>, <a href="https://gunicorn.org/" title="Gunicorn">Gunicorn</a>, <a href="https://github.com/Pylons/waitress" title="Waitress">waitress</a> etc. to host the webapp. For e.g. our Django app is hosted on a <a href="https://gunicorn.org/" title="Gunicorn">Gunicorn</a> server on the <a href="https://www.heroku.com/home" title="Heroku">Heroku</a> platform.</p>
<p>Another point is that although we have a Django webapp running on our server, it is functionally equivalent to a REST API. REST API is a popular architecture of communicating with remote servers. <a href="https://github.com/encode/django-rest-framework" title="DRF">Django Rest Framework</a> is widely used for writing such REST APIs.</p>
<p>Before describing the server in detail, lets mention that for the client, communicating with the server essentially boils down to sending correct HTTP request to the correct URL. Then on the server side Django will execute the view function corresponding to that URL. The structure of a general URL looks like :</p>
<p><code>server_domain/requested_backend/appropriate_view_name</code></p>
<p>So for example if the <code>server_domain=https://qsimsim.synqs.org/api/</code>, and we want to use <code>post_job</code> view for the <code>fermions</code> backend i.e.  <code>requested_backend=fermions</code> and <code>appropriate_view_name=post_job</code>. The complete URL will look like :</p>
<p><code>https://qsimsim.synqs.org/api/fermions/post_job/</code></p>
<p>Now we explain different view functions and their purpose :</p>
<ul>
<li><strong>The get_config view</strong> : This function returns a JSON dictionary containing the backend capabilities and details. At the moment this is relevant only for the Qiskit plugin as the pennylane plugin does not make use of it.</li>
<li><strong>The post_job view</strong> : This function extracts the JSON dictionary describing a potential experiment from a HTTP request. The extracted job_JSON is dumped onto <strong>Dropbox</strong> for further processing. It then responds with another JSON dictionary which has a <code>job_id</code> key. This job_id is important to query the server for results of the experiment later on. A typical JSON response from the server has the following schema:
<code>{'job_id': 'something','status': 'something','detail': 'something'}</code></li>
<li><strong>The get_job_status view</strong> : This function extracts the job_id of a previously submitted job from a HTTP request. It responds with a JSON dictionary describing the status.</li>
<li><strong>The get_job_result view</strong> : This function extracts the job_id of a previously submitted job from a HTTP request. If the job has not finished running and results are unavailable, it responds with a JSON dictionary describing the status. Otherwise it responds with a JSON dictionary describing the result. The formatting of the result dictionary is described in <a href="https://github.com/eggerdj/backends/" title="Qiskit_json">1</a>.</li>
<li><strong>The get_user_jobs view</strong> : This function returns a JSON dictionary containing all the jobs a user has submitted to this particular backend.</li>
<li><strong>The get_next_job_in_queue view</strong> : This function is not available to regular users. It is a very special function and is reserved for use only by the Spooler machine. Basically Spooler machine is the computer which is running the Spooler. It asks the server for the next job it should work on and the server replies with a JSON dictionary with details of the next job to be executed. From this, the Spooler knows exactly where the job JSON file is stored on Dropbox. It fetches the job JSON and starts to process it. Note that different Spoolers exist for different backends.</li>
</ul>
<p>We will frequently use the term status dictionary and result dictionary. These are just text files which host the appropriate JSON data. These files are stored on the Dropbox like job_JSON. When a view reads these text files, it coverts the data in them to a python dictionary and sends it to the client or modifies the dictionary further before saving it back to the text file.</p>
<p>Since we use Dropbox to store JSONs, the view functions call functions written in a file called <code>storage_providers.py</code> which in turn calls Dropbox python API functions for reading and writing to Dropbox. Note that Dropbox can be <strong>replaced</strong> with any other storage service (like Amazon S3, Microsoft azure storage, Google cloud storage etc.) which allows a user to read and write content using a python API. For this one would need to implement four basic functions for accessing the cloud storage provider. The details of these four functions are given in <code>storage_providers.py</code> with an example implementation for Dropbox. A new storage service can have its own class inheriting from the base class (just like the Dropbox class) and override the base functions.</p>
<h3 id="the-dropbox-storage">The Dropbox storage</h3>
<p>We use Dropbox to store all our JSONS. This approach has several benefits:</p>
<ul>
<li>We immediately implement asynchronous job management. Basically the Heroku server dumps the job coming from the remote client onto Dropbox. Then whenever the Spooler belonging to a backend is free, it will query to <code>get_next_job_in_queue</code> view and act on the next job which is appropriate for that particular backend.</li>
<li>Dropbox also serves as a database storage for various JSONs, like job_JSON, result_JSON, status_JSON etc. It gives us 2 GB free storage which is a lot considering price of commercial database alternatives.</li>
<li>It allows us to unify the workflow for both simulator and real machine. Basically it does not matter what the backend is, the workflow is the identical. Different backends only differ in their Spoolers.</li>
</ul>
<p>Now we describe how the Dropbox folder structure is organized. It is shown in following picture:
<img alt="" src="../dropbox.png" /></p>
<p>If one plans to replace Dropbox with other storage service, then one needs to implement a folder/naming structure similar to above.</p>
<p>Now lets give an example about the work flow. Lets say a remote client named <code>user_1</code> submits a job to the singlequdit backend. This means <code>user_1</code> sent a  post request to the following URL:</p>
<p><code>https://qsimsim.synqs.org/api/singlequdit/post_job/</code></p>
<p>The server will immediately save the JSON to <strong>Dropbox</strong> at <code>Backend_files/Queued_Jobs/singlequdit/job-20210906_203730-singlequdit-user_1-1088f.json</code>. The JSON file name has special meaning as will be explained later. The file is stored here temporarily before spooler processes it. At the same time the server will reply to the user with a job_id response which might look something like :</p>
<p><code>{'job_id': '20210906_203730-singlequdit-user_1-1088f','status': 'INITIALIZING','detail': 'Got your json.'}</code></p>
<p>This dictionary is also saved as a status JSON at <code>Backend_files/Status/singlequdit/user_1/status-20210906_203730-singlequdit-test-1088f.json</code>. Note the name is quite similar to the job JSON except a <code>status-</code> prefix.</p>
<p>The <code>job_id</code> key-value has lot of information. It has the UTC date and time of creation of the job <code>20210906_203730</code> which means it was created on 6 September 2021 at 20:37:30 PM UTC time. The job_id also has the user name who created this job i.e. <code>user_1</code> and the backend where this job is supposed to be executed i.e. <code>singlequdit</code>. At the end the job has some random alpha-numeric string of 5 characters.</p>
<p>On the spooler side, it will query the server for the next job it should work on. Also let us suppose the spooler is querying about the next job for <code>singlequdit</code> backend. The server looks for the file list in the directory <code>Backend_files/Queued_Jobs/singlequdit/</code>. It will choose the first created file from that list. Lets say this is the file <code>job-20210906_203730-singlequdit-user_1-1088f.json</code>. Now the server will move this file from <code>Backend_files/Queued_Jobs/singlequdit/job-20210906_203730-singlequdit-user_1-1088f.json</code> to <code>Backend_files/Running_Jobs/job-20210906_203730-singlequdit-user_1-1088f.json</code> and respond to the spooler with a <code>job_msg_dict</code> which looks like</p>
<p><code>{"job_id": "20210906_203730-singlequdit-user_1-1088f", "job_json": Backend_files/Running_Jobs/job-20210906_203730-singlequdit-user_1-1088f.json"}</code></p>
<p>From this, the Spooler knows exactly where the job JSON file is stored on Dropbox. It fetches the job JSON and starts to process it.</p>
<p>For processing the job, the spooler begins by sanity-checking the JSON for correct schema. If the job_JSON fails this check the file is moved to  <code>Backend_files/Deleted_Jobs/job-20210906_203730-singlequdit-user_1-1088f.json</code>. The status JSON is also updated by the spooler to:</p>
<p><code>{'job_id': '20210906_203730-singlequdit-user_1-1088f','status': 'ERROR','detail': 'Got your json.; Failed json sanity check. File will be deleted. Error message : blah..blah'}</code></p>
<p>From the dictionary, the user is automatically informed about the details of why the error happened.</p>
<p>If however, the job_JSON passes sanity checking, then it is executed. The spooler goes through the instruction list and creates the appropriate circuit and calculates the end result. Then it generates the given number of shots and formats everything into the result dictionary. The schema of the result dictionary is given at <a href="https://github.com/eggerdj/backends/" title="Qiskit_json">1</a>. Then the Spooler will upload the result JSON to <code>Backend_files/Result/singlequdit/user_1/result-20210906_203730-singlequdit-user_1-1088f.json</code>. It will also move the job JSON from <code>Backend_files/Running_Jobs/job-20210906_203730-singlequdit-user_1-1088f.json</code> to  <code>Backend_files/Finished_Jobs/singlequdit/user_1/job-20210906_203730-singlequdit-user_1-1088f.json</code>. Finally the spooler will update the status JSON to:</p>
<p><code>{'job_id': '20210906_203730-singlequdit-user_1-1088f','status': 'DONE','detail': 'Got your json.; Passed json sanity check; Compilation done. Shots sent to solver.'}</code></p>
<p>This completes the execution of the job and the results are now available.</p>
<h3 id="the-backends">The backends</h3>
<p>The backend can be a real cold atom machine or a simulator running on a computer. In summary, the backend runs a spooler which is responsible for executing job_JSONs and updating status_JSONs and result_JSONs. However different backends have different Spoolers. The Spoolers of different simulator backends have similar structure. The experiment backends have slightly different implementation of spoolers. This is because simulators and real machine operate in different conditions. We first describe the simulator backend and then the experiment one.</p>
<h4 id="the-simulator-backend">The simulator backend</h4>
<p>This is just a PC running spooler(s). The directory structure of Spooler is:
<img alt="" src="../spooler.png" /></p>
<p>The important file is the <strong>maintainer.py</strong>. It runs an endless while loop. Every 2 seconds The maintainer.py asks the serevr for the next job to be executed for a particular backend. If the server replies with a job, the maintainer will execute the appropriate Spooler.py file for that backend. If the server replied with empty response then the loop continues and maintainer.py will ask for job for the next backend defined in the list <code>backends_list</code>.</p>
<p>Lets consider the case where the server replied with a job name. The maintainer will download the contents of this job_JSON and also the status_JSON. Both the job dictionary and status dictionary are passed as an argument to the <code>add_job</code> function of the appropriate Spooler for that backend.</p>
<p>The <code>add_job</code> function will perform sanity check on the JSON and execute the circuit. Then it will upload all results and status accordingly. The details on how exactly the circuits are executed will be described in future.</p>
<p>Also note that for reading writing to Dropbox on the Spooler PC too use Dropbox python API. The commands are in the file <code>drpbx.py</code></p>
<p>There are some important points to note here:</p>
<ul>
<li>The maintainer.py is a python program. It might very well crash and then our simulator is no longer executing circuits. Although the server is still fine and storing jobs properly but the jobs will be in waiting queue as long as the Spooler is dead. As a quick fix to this problem, we do not run the maintainer.py file directly. Instead we have a bash script <code>keep_running.sh</code> which runs the maintainer.py in a loop. If python file crashes the bash script will automatically restart it. This is a temporary fix for now and will be replaced by a more professional solution using <code>cron</code> or <code>supervisord</code> in near future.</li>
<li>The spooler is a virtual machine (VM) living in the cloud. We need a professional way to deploy the code on the VM. This support also will be included in near future where whenever a developer makes a push to the Spooler github repository <code>coquma-sim-spooler</code>, the new files are automatically copied and deployed to the VM.</li>
</ul>
<p>All code for the spoolers is in a separate GitHub repository which we will make public later on.</p>
<h4 id="the-experiment-backend">The experiment backend</h4>
<p>A first draft for implementing the experiment backends is highlighted <a href="https://github.com/synqs/labscript-qc" title="labscript-qc">here</a>. The code was tested to perform MOT loading in a cold atom machine in Heidelberg by submitting circuits from Zurich. Although we still need to polish this part of the code, it already highlights important ideas on how to connect a real cold atom machine to <a href="https://github.com/synqs/qlue" title="qlue">qlue</a>.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dev_guide/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Developer Guide" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Developer Guide
            </div>
          </div>
        </a>
      
      
        
        <a href="../user_guide/" class="md-footer__link md-footer__link--next" aria-label="Next: User Guide" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              User Guide
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>